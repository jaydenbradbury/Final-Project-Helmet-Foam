---
title: "EDA_Thieman"
format: html
editor: visual
---

```{r, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(lme4)
df <- read.csv("clean_data.csv")

df <- df %>%
  mutate(Time = freq*num_squish)
```

```{r}
head(df)
df <- df%>% filter(Cycle != "A")
```

```{r}
ggplot(df, aes(y = Estatic_rel, x = Porosity)) + 
  geom_boxplot()

```

```{r}
 ggplot(df, aes(y = Estatic_rel, x = ChemIndex)) + 
  geom_boxplot()
```
```{r}

ggplot(df, aes(
    x = num_squish,
    y = Estatic_rel,
    group = interaction(ChemIndex, Porosity),
    color = interaction(ChemIndex, Porosity)
  )) +
geom_point(size = 2) +
  labs(
    title = "Estatic_rel Across Time by Foam Type and Porosity",
    x = "Num_Squish",
    y = "Standardized Estatic Stange",
    color = "chemindex / Porosity"
  ) +
  theme_minimal()

```
```{r}
ggplot(df, aes(x = ChemIndex, y = Estatic_rel, fill = Porosity)) +
  geom_boxplot(position = position_dodge(width = 0.8)) +
  labs(title = "Estatic_rel by ChemIndex and Porosity",
       x = "ChemIndex",
       y = "Estatic_rel") +
  theme_minimal()
```

```{r}
ggplot(df, aes(
    x = Time,
    y = Estatic_rel,
    group = interaction(ChemIndex, Porosity),
    color = interaction(ChemIndex, Porosity)
  )) +
geom_point(size = 2) +
  labs(
    title = "Estatic_rel Across Time by Foam Type and Porosity",
    x = "Time",
    y = "Standardized Estatic Stange",
    color = "chemindex / Porosity"
  ) +
  theme_minimal()
```

$$
\widehat{\text{Estatic_relative}} = strain + stress + relporo + amplitute + time + Porosity*ChemIndex + \epsilon\\

a_i = \alpha _0 + \alpha_1 (Stress) + \alpha_2 (Frequency) + \alpha_3 (Number Squish) + \alpha_4 I (Porosity * ChemIndex) + \alpha_5 (amp*ChemIndex) + \alpha_6 ( freq * num_squish) + u_i \\
b_i = \beta _0 + \beta_1 (Stress) + \beta_2 (Frequency) + \beta_3 (Number Squish) + \beta_I (Porosity * ChemIndex) + \beta_5 (amp*ChemIndex) + \beta_6 ( freq * num_squish) + v_i \\

Y_{ij} = (\alpha _0 + \alpha_1 (Stress) + \alpha_2 (Frequency) + \alpha_3 (Number Squish) + \alpha_4 I (Porosity * ChemIndex) + \alpha_5 (amp*ChemIndex) + \alpha_6 ( freq * num_squish) + u_i) + (\beta _0 + \beta_1 (Stress) + \beta_2 (Frequency) + \beta_3 (Number Squish) + \beta_I (Porosity * ChemIndex) + \beta_5 (amp*ChemIndex) + \beta_6 ( freq * num_squish) + v_i)(Time) + \epsilon_i


$$
```{r}

First_model <- lmer(Estatic_rel ~  Stress_kPa + freq + num_squish + num_squish:Porosity*ChemIndex + amp*ChemIndex + Time + (Time|SampleCode), data = df)

summary(First_model)

library(nlme)
m1 <- lme(Estatic_rel ~  Stress_kPa + freq + num_squish + num_squish:Porosity*ChemIndex + amp*ChemIndex + Time ,random=~Time|SampleCode,data=df)
anova(m1)


```
```{r}
library(ggeffects)

# Get predicted values for num_squish across Porosity and ChemIndex
preds <- ggpredict(First_model, terms = c("num_squish", "Porosity", "ChemIndex"))
ggplot(preds, aes(x = x, y = predicted)) +
  geom_line(color = "steelblue", size = 1) +
  geom_ribbon(aes(ymin = conf.low, ymax = conf.high), fill = "steelblue", alpha = 0.2) +
  facet_wrap(~interaction(group, facet), ncol = 2) +  # 2 columns, change as needed
  labs(
    x = "Number of Squish",
    y = "Predicted Estatic_rel",
    title = "Predicted Estatic_rel by num_squish across Porosity x ChemIndex",
    subtitle = "Each panel is a Porosity Ã— ChemIndex combination"
  ) +
  theme_minimal(base_size = 14)

```
```{r}
ggplot(df, aes(y = Estatic_rel, x = num_squish, group))+
  geom_point(aes(x = num_squish, group = interaction(ChemIndex, Porosity)), color = interaction(ChemIndex, Porosity))
```

$$
b_i = \beta _0 + \beta_1 (Stress) + \beta_2 (Frequency)  + \beta_3 (Porosity * ChemIndex) + \beta_4 (amp*ChemIndex) + \beta_5 ( freq * numSquish) + v_i
$$